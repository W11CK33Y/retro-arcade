<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üß± Tetris | Retro Arcade</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
  font-family: 'Press Start 2P', monospace;
  background: radial-gradient(circle at center, #1a0028 0%, #080010 80%);
  color: #d78aff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  overflow: hidden;
  text-align: center;
  position: relative;
}

h1 {
  font-size: 1.4rem;
  text-shadow: 0 0 10px #d78aff, 0 0 20px #a84aff;
  margin-bottom: 5px;
}

canvas {
  border: 3px solid #d78aff;
  background: #12001d;
  box-shadow: 0 0 20px #a84aff, 0 0 40px #8a2be2;
}

#scoreboard {
  margin: 10px 0;
  font-size: 0.7rem;
  display: flex;
  justify-content: space-around;
  width: 240px;
  text-shadow: 0 0 8px #d78aff;
}

button {
  margin: 10px 0;
  background: transparent;
  border: 2px solid #d78aff;
  color: #d78aff;
  padding: 0.7rem 1.5rem;
  cursor: pointer;
  font-family: inherit;
  text-shadow: 0 0 8px #d78aff;
  transition: all 0.2s ease;
}

button:hover {
  background: #d78aff;
  color: #1a0028;
  box-shadow: 0 0 20px #d78aff, 0 0 40px #8a2be2;
  transform: scale(1.05);
}

footer {
  font-size: 0.7rem;
  color: #d78affaa;
  margin-top: 5px;
}

.scanlines {
  position: absolute;
  top:0; left:0; width:100%; height:100%;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.03) 1px,
    transparent 2px,
    transparent 3px
  );
  pointer-events: none;
  z-index: 10;
}
</style>
</head>
<body>
<div class="scanlines"></div>
<h1>üß± Tetris</h1>

<div id="scoreboard">
  <div>Score: <span id="score">0</span></div>
  <div>High: <span id="highscore">0</span></div>
</div>

<button id="themeBtn">üé® Change Theme</button>
<canvas id="tetris" width="240" height="400"></canvas>
<footer>‚Üê ‚Üí Move | ‚Üë Rotate | ‚Üì Drop | Swipe on mobile!</footer>

<script>
// ---------- Themes ----------
const themes = [
  { bodyBg:"radial-gradient(circle at center, #1a0028 0%, #080010 80%)", text:"#d78aff", glow:"#a84aff", blocks:["#d78aff","#a84aff","#8a2be2","#bb86fc","#c77dff","#d0a2ff","#b066ff"] },
  { bodyBg:"radial-gradient(circle at center, #001a00 0%, #000800 80%)", text:"#00ff88", glow:"#00ffaa", blocks:["#00ff88","#00ffaa","#33ff66","#66ff33","#99ff00","#00cc44","#00aa33"] },
  { bodyBg:"radial-gradient(circle at center, #2a001a 0%, #100008 80%)", text:"#ff00aa", glow:"#ff66cc", blocks:["#ff00aa","#ff66cc","#ff3399","#ff3399","#ff0099","#ff3399","#ff66aa"] }
];

let currentTheme = parseInt(localStorage.getItem("retroTheme")) || 0;
const themeBtn = document.getElementById("themeBtn");

themeBtn.addEventListener("click", ()=>{
  currentTheme = (currentTheme+1)%themes.length;
  localStorage.setItem("retroTheme", currentTheme);
  applyTheme(themes[currentTheme]);
});

function applyTheme(theme){
  document.body.style.background = theme.bodyBg;
  document.body.style.color = theme.text;
  document.querySelector("h1").style.textShadow = `0 0 10px ${theme.text},0 0 20px ${theme.glow}`;
  canvas.style.border = `3px solid ${theme.text}`;
}
applyTheme(themes[currentTheme]);

// ---------- Tetris Logic ----------
const canvas = document.getElementById("tetris");
const ctx = canvas.getContext("2d");
const ROW=20, COL=10, SQ=20, VACANT="#12001d";
let board = Array.from({length:ROW}, ()=>Array(COL).fill(VACANT));
let score = 0;
let highscore = localStorage.getItem("retro_tetris_highscore") || 0;
document.getElementById("highscore").textContent = highscore;

function drawSquare(x,y,color){
  ctx.fillStyle=color;
  ctx.fillRect(x*SQ,y*SQ,SQ,SQ);
  ctx.strokeStyle="#2a003f";
  ctx.strokeRect(x*SQ,y*SQ,SQ,SQ);
}

// Draw board
function drawBoard(){for(let r=0;r<ROW;r++){for(let c=0;c<COL;c++){drawSquare(c,r,board[r][c]);}}}
drawBoard();

// Tetrominoes
const PIECES = [
  [ [ [[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]], [[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]] ], 0 ],
  [ [ [[1,0,0],[1,1,1],[0,0,0]], [[0,1,1],[0,1,0],[0,1,0]], [[0,0,0],[1,1,1],[0,0,1]], [[0,1,0],[0,1,0],[1,1,0]] ],1 ],
  [ [ [[0,0,1],[1,1,1],[0,0,0]], [[0,1,0],[0,1,0],[0,1,1]], [[0,0,0],[1,1,1],[1,0,0]], [[1,1,0],[0,1,0],[0,1,0]] ],2 ],
  [ [ [[1,1],[1,1]] ],3 ],
  [ [ [[0,1,1],[1,1,0],[0,0,0]], [[0,1,0],[0,1,1],[0,0,1]] ],4 ],
  [ [ [[0,1,0],[1,1,1],[0,0,0]], [[0,1,0],[0,1,1],[0,1,0]], [[0,0,0],[1,1,1],[0,1,0]], [[0,1,0],[1,1,0],[0,1,0]] ],5 ],
  [ [ [[1,1,0],[0,1,1],[0,0,0]], [[0,0,1],[0,1,1],[0,1,0]] ],6 ]
];

function randomPiece(){return new Piece(PIECES[Math.floor(Math.random()*PIECES.length)][0], themes[currentTheme].blocks[Math.floor(Math.random()*themes[currentTheme].blocks.length)]);}

function Piece(tetromino,color){
  this.tetromino=tetromino;
  this.color=color;
  this.tetrominoN=0;
  this.activeTetromino=this.tetromino[this.tetrominoN];
  this.x=3;
  this.y=-2;
}

Piece.prototype.fill=function(color){for(let r=0;r<this.activeTetromino.length;r++){for(let c=0;c<this.activeTetromino.length;c++){if(this.activeTetromino[r][c]) drawSquare(this.x+c,this.y+r,color);}}};
Piece.prototype.draw=function(){this.fill(this.color);};
Piece.prototype.unDraw=function(){this.fill(VACANT);};

Piece.prototype.moveDown=function(){if(!this.collision(0,1,this.activeTetromino)){this.unDraw();this.y++;this.draw();}else{this.lock();p=randomPiece();}};
Piece.prototype.moveRight=function(){if(!this.collision(1,0,this.activeTetromino)){this.unDraw();this.x++;this.draw();}};
Piece.prototype.moveLeft=function(){if(!this.collision(-1,0,this.activeTetromino)){this.unDraw();this.x--;this.draw();}};
Piece.prototype.rotate=function(){let nextPattern=this.tetromino[(this.tetrominoN+1)%this.tetromino.length];let kick=0;if(this.collision(0,0,nextPattern)) kick=this.x>COL/2?-1:1;if(!this.collision(kick,0,nextPattern)){this.unDraw();this.x+=kick;this.tetrominoN=(this.tetrominoN+1)%this.tetromino.length;this.activeTetromino=this.tetromino[this.tetrominoN];this.draw();}};
Piece.prototype.lock=function(){
  for(let r=0;r<this.activeTetromino.length;r++){
    for(let c=0;c<this.activeTetromino.length;c++){
      if(!this.activeTetromino[r][c]) continue;
      if(this.y+r<0){gameOver(); return;}
      board[this.y+r][this.x+c]=this.color;
    }
  }
  for(let r=0;r<ROW;r++){
    let isRowFull=board[r].every(cell=>cell!==VACANT);
    if(isRowFull){
      for(let y=r;y>0;y--){for(let c=0;c<COL;c++){board[y][c]=board[y-1][c];}} 
      for(let c=0;c<COL;c++){board[0][c]=VACANT;}
      score+=10;
      document.getElementById("score").textContent=score;
      if(score>highscore){highscore=score; localStorage.setItem("retro_tetris_highscore",highscore); document.getElementById("highscore").textContent=highscore;}
    }
  }
  drawBoard();
};

Piece.prototype.collision=function(x,y,piece){
  for(let r=0;r<piece.length;r++){
    for(let c=0;c<piece.length;c++){
      if(!piece[r][c]) continue;
      let newX=this.x+c+x;
      let newY=this.y+r+y;
      if(newX<0||newX>=COL||newY>=ROW) return true;
      if(newY<0) continue;
      if(board[newY][newX]!==VACANT) return true;
    }
  }
  return false;
};

// ---------- Controls ----------
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") p.moveLeft();
  else if(e.key==="ArrowRight") p.moveRight();
  else if(e.key==="ArrowUp") p.rotate();
  else if(e.key==="ArrowDown") p.moveDown();
});

// Mobile swipe controls
let touchStartX=0, touchStartY=0;
canvas.addEventListener("touchstart", e=>{touchStartX=e.touches[0].clientX; touchStartY=e.touches[0].clientY;}, false);
canvas.addEventListener("touchend", e=>{
  let dx=e.changedTouches[0].clientX-touchStartX;
  let dy=e.changedTouches[0].clientY-touchStartY;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>30) p.moveRight();
    else if(dx<-30) p.moveLeft();
  }else{
    if(dy>30) p.moveDown();
    else if(dy<-30) p.rotate();
  }
}, false);

// ---------- Game Loop ----------
let p=randomPiece();
p.draw(); // Draw first piece immediately
let dropStart=Date.now();
let gameIsOver=false;

function drop(){
  let now=Date.now();
  let delta=now-dropStart;
  if(delta>500){p.moveDown(); dropStart=now;}
  if(!gameIsOver) requestAnimationFrame(drop);
}
drop();

function gameOver(){gameIsOver=true; alert("Game Over!"); location.reload();}
</script>
</body>
</html>
