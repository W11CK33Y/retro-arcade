<!DOCTYPE html>
<html lang="en">
<head>
<script src="js/theme.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß± Tetris | Retro Arcade</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Press Start 2P', monospace;
      background: radial-gradient(circle at center, #1a0028 0%, #080010 80%);
      color: #d78aff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      text-align: center;
      position: relative;
    }

    h1 {
      font-size: 1.4rem;
      text-shadow: 0 0 10px #d78aff, 0 0 25px #a84aff;
      margin-bottom: 5px;
      animation: flicker 2s infinite alternate;
    }

    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
      20%, 24%, 55% { opacity: 0.4; }
    }

    #scoreboard {
      margin-bottom: 10px;
      font-size: 0.7rem;
      display: flex;
      justify-content: space-around;
      width: 240px;
      text-shadow: 0 0 8px #d78aff;
    }

    canvas {
      border: 3px solid #d78aff;
      box-shadow: 0 0 20px #a84aff, 0 0 40px #8a2be2;
      background: #12001d;
    }

    button {
      margin-top: 12px;
      background: transparent;
      border: 2px solid #d78aff;
      color: #d78aff;
      padding: 0.7rem 1.5rem;
      font-size: 0.8rem;
      font-family: inherit;
      text-shadow: 0 0 8px #d78aff;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    button:hover {
      background: #d78aff;
      color: #1a0028;
      box-shadow: 0 0 20px #d78aff, 0 0 40px #8a2be2;
      transform: scale(1.05);
    }

    #gameOver {
      display: none;
      position: absolute;
      background: rgba(26, 0, 40, 0.9);
      border: 2px solid #d78aff;
      box-shadow: 0 0 30px #a84aff;
      padding: 20px;
      border-radius: 8px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #d78aff;
      z-index: 50;
      animation: popIn 0.4s ease;
    }

    @keyframes popIn {
      from { transform: translate(-50%, -60%) scale(0.8); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    footer {
      position: absolute;
      bottom: 20px;
      font-size: 0.7rem;
      color: #d78affaa;
    }

    .scanlines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.03),
        rgba(255, 255, 255, 0.03) 1px,
        transparent 2px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="scanlines"></div>
  <h1>üß± Tetris</h1>

  <div id="scoreboard">
    <div>Score: <span id="score">0</span></div>
    <div>High: <span id="highscore">0</span></div>
  </div>

<!-- Add this inside <body>, above canvas -->
<button id="themeBtn">üé® Change Theme</button>

<script>
  // Define your themes
  const themes = [
    { // Purple
      bodyBg: "radial-gradient(circle at center, #1a0028 0%, #080010 80%)",
      text: "#d78aff",
      glow: "#a84aff",
      canvasBorder: "#d78aff",
      canvasBg: "#12001d",
      blocks: ["#d78aff","#a84aff","#8a2be2","#bb86fc","#c77dff","#d0a2ff","#b066ff"]
    },
    { // Neon Green
      bodyBg: "radial-gradient(circle at center, #001a00 0%, #000800 80%)",
      text: "#00ff88",
      glow: "#00ffaa",
      canvasBorder: "#00ff88",
      canvasBg: "#001100",
      blocks: ["#00ff88","#00ffaa","#33ff66","#66ff33","#99ff00","#00cc44","#00aa33"]
    },
    { // Hot Pink
      bodyBg: "radial-gradient(circle at center, #2a001a 0%, #100008 80%)",
      text: "#ff00aa",
      glow: "#ff66cc",
      canvasBorder: "#ff00aa",
      canvasBg: "#1a0011",
      blocks: ["#ff00aa","#ff66cc","#ff3399","#ff3399","#ff0099","#ff3399","#ff66aa"]
    }
  ];

  let currentTheme = 0;
  const themeBtn = document.getElementById("themeBtn");

  themeBtn.addEventListener("click", () => {
    currentTheme = (currentTheme + 1) % themes.length;
    applyTheme(themes[currentTheme]);
  });

  function applyTheme(theme) {
    document.body.style.background = theme.bodyBg;
    document.body.style.color = theme.text;
    document.querySelector("h1").style.textShadow = `0 0 10px ${theme.text}, 0 0 25px ${theme.glow}`;
    document.querySelector("canvas").style.border = `3px solid ${theme.canvasBorder}`;
    document.querySelector("canvas").style.background = theme.canvasBg;
    document.getElementById("scoreboard").style.color = theme.text;
    document.getElementById("scoreboard").style.textShadow = `0 0 8px ${theme.text}`;

    // Update block colors dynamically
    PIECES.forEach((p, index) => { p[1] = theme.blocks[index]; });

    // Redraw board with new colors
    drawBoard();
    p.draw();
  }

  // Initialize with first theme
  applyTheme(themes[currentTheme]);
</script>



  <canvas id="tetris" width="240" height="400"></canvas>

  <button onclick="window.location.href='index.html'">üè† Back to Arcade</button>
  <footer>‚Üê ‚Üí Move | ‚Üë Rotate | ‚Üì Drop</footer>

  <div id="gameOver">
    <h2>üíÄ GAME OVER üíÄ</h2>
    <p>Your Score: <span id="finalScore"></span></p>
    <p>High Score: <span id="finalHighScore"></span></p>
    <button onclick="restartGame()">üîÑ Play Again</button>
  </div>

  <script>
    const canvas = document.getElementById("tetris");
    const ctx = canvas.getContext("2d");
    const ROW = 20;
    const COL = COLUMN = 10;
    const SQ = 20;
    const VACANT = "#12001d";

    let score = 0;
    let highscore = localStorage.getItem("retro_tetris_highscore") || 0;
    document.getElementById("highscore").textContent = highscore;

    function drawSquare(x, y, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x * SQ, y * SQ, SQ, SQ);
      ctx.strokeStyle = "#2a003f";
      ctx.strokeRect(x * SQ, y * SQ, SQ, SQ);
      ctx.shadowColor = color;
      ctx.shadowBlur = 8;
    }

    // Create the board
    let board = [];
    for (r = 0; r < ROW; r++) {
      board[r] = [];
      for (c = 0; c < COL; c++) {
        board[r][c] = VACANT;
      }
    }

    function drawBoard() {
      for (r = 0; r < ROW; r++) {
        for (c = 0; c < COL; c++) {
          drawSquare(c, r, board[r][c]);
        }
      }
    }

    drawBoard();

    const I = [
      [
        [0,0,0,0],
        [1,1,1,1],
        [0,0,0,0],
        [0,0,0,0]
      ],
      [
        [0,0,1,0],
        [0,0,1,0],
        [0,0,1,0],
        [0,0,1,0]
      ],
    ];

    const J = [
      [
        [1,0,0],
        [1,1,1],
        [0,0,0]
      ],
      [
        [0,1,1],
        [0,1,0],
        [0,1,0]
      ],
      [
        [0,0,0],
        [1,1,1],
        [0,0,1]
      ],
      [
        [0,1,0],
        [0,1,0],
        [1,1,0]
      ],
    ];

    const L = [
      [
        [0,0,1],
        [1,1,1],
        [0,0,0]
      ],
      [
        [0,1,0],
        [0,1,0],
        [0,1,1]
      ],
      [
        [0,0,0],
        [1,1,1],
        [1,0,0]
      ],
      [
        [1,1,0],
        [0,1,0],
        [0,1,0]
      ],
    ];

    const O = [[[1,1],[1,1]]];
    const S = [
      [
        [0,1,1],
        [1,1,0],
        [0,0,0]
      ],
      [
        [0,1,0],
        [0,1,1],
        [0,0,1]
      ],
    ];
    const T = [
      [
        [0,1,0],
        [1,1,1],
        [0,0,0]
      ],
      [
        [0,1,0],
        [0,1,1],
        [0,1,0]
      ],
      [
        [0,0,0],
        [1,1,1],
        [0,1,0]
      ],
      [
        [0,1,0],
        [1,1,0],
        [0,1,0]
      ],
    ];
    const Z = [
      [
        [1,1,0],
        [0,1,1],
        [0,0,0]
      ],
      [
        [0,0,1],
        [0,1,1],
        [0,1,0]
      ],
    ];

    const PIECES = [
      [Z, "#d78aff"],
      [S, "#a84aff"],
      [T, "#8a2be2"],
      [O, "#bb86fc"],
      [L, "#c77dff"],
      [I, "#d0a2ff"],
      [J, "#b066ff"]
    ];

    function randomPiece() {
      let r = Math.floor(Math.random() * PIECES.length);
      return new Piece(PIECES[r][0], PIECES[r][1]);
    }

    function Piece(tetromino, color) {
      this.tetromino = tetromino;
      this.color = color;
      this.tetrominoN = 0;
      this.activeTetromino = this.tetromino[this.tetrominoN];
      this.x = 3;
      this.y = -2;
    }

    Piece.prototype.fill = function(color) {
      for (r = 0; r < this.activeTetromino.length; r++) {
        for (c = 0; c < this.activeTetromino.length; c++) {
          if (this.activeTetromino[r][c]) drawSquare(this.x + c, this.y + r, color);
        }
      }
    };

    Piece.prototype.draw = function() { this.fill(this.color); };
    Piece.prototype.unDraw = function() { this.fill(VACANT); };

    Piece.prototype.moveDown = function() {
      if (!this.collision(0, 1, this.activeTetromino)) {
        this.unDraw();
        this.y++;
        this.draw();
      } else {
        this.lock();
        p = randomPiece();
      }
    };

    Piece.prototype.moveRight = function() {
      if (!this.collision(1, 0, this.activeTetromino)) {
        this.unDraw(); this.x++; this.draw();
      }
    };

    Piece.prototype.moveLeft = function() {
      if (!this.collision(-1, 0, this.activeTetromino)) {
        this.unDraw(); this.x--; this.draw();
      }
    };

    Piece.prototype.rotate = function() {
      let nextPattern = this.tetromino[(this.tetrominoN + 1) % this.tetromino.length];
      let kick = 0;
      if (this.collision(0, 0, nextPattern)) kick = this.x > COL / 2 ? -1 : 1;
      if (!this.collision(kick, 0, nextPattern)) {
        this.unDraw();
        this.x += kick;
        this.tetrominoN = (this.tetrominoN + 1) % this.tetromino.length;
        this.activeTetromino = this.tetromino[this.tetrominoN];
        this.draw();
      }
    };

    Piece.prototype.lock = function() {
      for (r = 0; r < this.activeTetromino.length; r++) {
        for (c = 0; c < this.activeTetromino.length; c++) {
          if (!this.activeTetromino[r][c]) continue;
          if (this.y + r < 0) {
            gameOver();
            return;
          }
          board[this.y + r][this.x + c] = this.color;
        }
      }

      for (r = 0; r < ROW; r++) {
        let isRowFull = board[r].every(cell => cell !== VACANT);
        if (isRowFull) {
          for (y = r; y > 1; y--) {
            for (c = 0; c < COL; c++) {
              board[y][c] = board[y - 1][c];
            }
          }
          for (c = 0; c < COL; c++) board[0][c] = VACANT;
          score += 10;
          document.getElementById("score").textContent = score;
          if (score > highscore) {
            highscore = score;
            localStorage.setItem("retro_tetris_highscore", highscore);
            document.getElementById("highscore").textContent = highscore;
          }
        }
      }

      drawBoard();
    };

    Piece.prototype.collision = function(x, y, piece) {
      for (r = 0; r < piece.length; r++) {
        for (c = 0; c < piece.length; c++) {
          if (!piece[r][c]) continue;
          let newX = this.x + c + x;
          let newY = this.y + r + y;
          if (newX < 0 || newX >= COL || newY >= ROW) return true;
          if (newY < 0) continue;
          if (board[newY][newX] != VACANT) return true;
        }
      }
      return false;
    };

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") p.moveLeft();
      else if (e.key === "ArrowRight") p.moveRight();
      else if (e.key === "ArrowUp") p.rotate();
      else if (e.key === "ArrowDown") p.moveDown();
    });

    let p = randomPiece();
    let dropStart = Date.now();
    let gameIsOver = false;

    function drop() {
      let now = Date.now();
      let delta = now - dropStart;
      if (delta > 500) {
        p.moveDown();
        dropStart = Date.now();
      }
      if (!gameIsOver) requestAnimationFrame(drop);
    }

    drop();

    function gameOver() {
      gameIsOver = true;
      document.getElementById("finalScore").textContent = score;
      document.getElementById("finalHighScore").textContent = highscore;
      document.getElementById("gameOver").style.display = "block";
    }

    function restartGame() {
      window.location.reload();
    }
  </script>
</body>
</html>
